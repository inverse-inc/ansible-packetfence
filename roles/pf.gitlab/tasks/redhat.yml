---
- name: install dependencies to install packages from repo
  yum:
    name: "{{ gitlab__rpm_pkgs }}"
    state: latest

- name: add public key
  rpm_key: 
    state: present
    key: "{{ gitlab__project_gpg_key_url }}"

- name: install {{ gitlab__project_name }} repo from gitlab pages
  yum_repository:
    name: "{{ gitlab__project_name }}"
    description: "{{ gitlab__project_name }} repo"
    baseurl: "{{ gitlab__ci_pages_url }}/centos/$releasever/$basearch"
    enabled: yes
    gpgcheck: yes
    gpgkey: "{{ gitlab__project_gpg_key_url }}"
    metadata_expire: 900
    skip_if_unavailable: no
    repo_gpgcheck: no

- name: install package from repo
  yum:
    name: "{{ gitlab__built_pkg }}"
    update_cache: yes
    state: latest