---
- name: install pf.conf
  template:
    src: pf.conf.j2
    dest: "{{ pf_conf_dir }}/pf.conf"
    mode: 0640
    owner: "{{ pf_user }}"
    group: "{{ pf_group }}"
  diff: true

- name: change default admin password in db through pfperl-api
  command:
  args:
    argv:
      - "{{ pf_perlapi_cmd }}"
      - get
      - "-M"
      - PACTH
      - "{{ pf_api_user }}/{{ pf_admin_user['pid'] }}/password"
      - "-c"
      - "{{ pf_admin_user | to_json }}"
  register: api_user_result
  # failed when status is different from 200
  # pfperl-api always return rc=0
  failed_when: (api_user_result['stdout'] | from_json ).status != 200